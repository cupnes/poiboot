# poiboot
UEFIを直接叩いて動作するx86_64アーキテクチャ向けの簡易ブートローダーです。

UEFI用のパーティション(GPTでフォーマットされたパーティション、あるいはFATでも可)に配置されたkernel.bin(必須)とfs.img(あれば)をメモリへロードし、kernel.binをロードした先へジャンプします。

## サポートするバイナリフォーマット
poibootはkernel.binとfs.imgというファイル名のバイナリをメモリへロードします。

それぞれのバイナリフォーマットは以下の通りです。

### kernel.bin
16バイトのヘッダと実行バイナリ本体の構成です。

先頭からのバイト数|内容
---|---
先頭16バイト|ヘッダ
17バイト目以降|実行バイナリ本体

ヘッダ(16バイト)のフォーマットは以下の通りです。

先頭からのバイト数|内容
---|---
先頭8バイト|bss領域の先頭アドレス
7バイト目以降|bss領域のサイズ

poibootは、実行バイナリ本体へジャンプする前に、ヘッダに指定されたbss領域(*1)をゼロクリアします。詳しくは後述の「動作仕様」で説明します。

(*1): 初期値がゼロあるいは初期値無しのグローバル変数や、スタティック変数が配置される領域で、実行前にゼロで初期化しておくべき領域。

### fs.img
オプショナルで、kernel.binと同じ階層にあればメモリへロードします。

このバイナリはブートローダーから扱うものではないので、どのようなバイナリフォーマットでも構いません。poibootとしては、「fs.img」という名前のバイナリをそのままメモリへロードします。

## 動作仕様
poibootの動作は以下の通りです。

### 1. kernel.binが存在するパーティションを探す

### 2. poiboot.confのロード

### 3. kernel.binのロード

### 4. fs.imgのロード

### 5. APコアの起動

### 6. UEFIの終了

### 7. カーネルへジャンプ

## 使い方
### 1. カーネルバイナリとファイルシステムイメージ(必要なら)を用意
poibootは、簡単な独自フォーマットのカーネルバイナリ(kernel.bin)とファイルシステムイメージ(fs.img)をメモリへロードします。
